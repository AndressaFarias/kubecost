# Criando relat√≥rios de uso e de custo
_[Creating Cost and Usage Reports](
https://docs.aws.amazon.com/cur/latest/userguide/cur-create.html)_

Voc√™ pode usar a p√°gina Cost & Usage Reports do console Billing and Cost Management para criar Relat√≥rios Cost and Usage.

üìå Pode levar at√© 24 horas para que a AWS comece a entregar relat√≥rios ao seu bucket do Amazon S3. Ap√≥s o in√≠cio da entrega, a AWS atualiza os arquivos de relat√≥rios de uso e custo da AWS pelo menos uma vez por dia.

## Criar relat√≥rios Cost and Usage
_To create Cost and Usage Reports_


1. Fa√ßa login no console do **Billing and Cost Management** em https://console.aws.amazon.com/billing/home#/

2. No painel de navega√ß√£o, selecione **Cost and Usage Report**.

3. Escolha Create report (Criar relat√≥rio).

4. Em Report name (Nome do relat√≥rio), insira um nome para o relat√≥rio

üìå O nome do relat√≥rio deve ser √∫nico e conter apenas caracteres alfanum√©ricos! - _ . * '( )

5. Em _Additional report details_ (Detalhes adicionais do relat√≥rio), selecione _Include resource IDs_ (Incluir IDs de recurso) para incluir os IDs de cada recurso individual no relat√≥rio.

üìå A inclus√£o de IDs de recursos criar√° itens de linha individuais para cada um de seus recursos. Isso pode aumentar significativamente o tamanho dos seus arquivos de Relat√≥rios de custos e uso, com base noAWSuso do.


üìå Pode levar at√© 24 horas porAWSPara come√ßar a entregar relat√≥rios no bucket do Amazon S3. Ap√≥s o in√≠cio da entrega,AWSatualiza oAWSRelat√≥rios de custos e uso pelo menos uma vez por dia.

üìå Quando os recursos s√£o criados, a AWS atribui um ID de recurso exclusivo a cada um deles. Incluir IDs de recursos individuais em seu relat√≥rio pode aumentar significativamente o tamanho do arquivo.


6. Para Data refresh settings (configura√ß√µes de atualiza√ß√£o de dados), selecione se deseja que os relat√≥rios de uso e custo da AWS sejam atualizados se a AWS aplicar reembolsos, cr√©ditos ou taxas de suporte √† sua conta ap√≥s finalizar sua fatura. Quando um relat√≥rio √© atualizado, um novo relat√≥rio √© carregado no Amazon S3.

üìå Muitas vezes, essas cobran√ßas est√£o relacionadas com reembolsos, cr√©ditos e taxas do AWS Support.

üìå  Selecionar essa op√ß√£o atualiza automaticamente seu Relat√≥rio de uso e custos quando forem detectadas cobran√ßas de meses anteriores com faturas fechadas

7. Avan√ßar.

8. Para bucket do S3, escolha Configure.
    
    üìå Para receber os relat√≥rios de uso e custo da AWS, voc√™ deve ter um bucket do Amazon S3 criado e configurado com as permiss√µes de acesso apropriadas. Voc√™ pode adicionar um bucket existente ou criar um novo.

 9. Na caixa de di√°logo _S3 bucket - required_ clique em _Configure_ , siga um destes procedimentos:

  * _Select existing bucket_ : Selecione um bucket existente na lista suspensa e escolha Next.

  * Create a bucket: selecione o bucket e a regi√£o e escolha Next.

       üìå Se voc√™ criar um bucket para relat√≥rios de custo e uso da AWS, as configura√ß√µes e permiss√µes padr√£o ser√£o aplicadas. Ap√≥s a cria√ß√£o do bucket, voc√™ pode atualizar as configura√ß√µes e permiss√µes no console do Amazon S3.

       üìå Algumas regi√µes s√£o desabilitadas por padr√£o. Para criar um bucket em uma dessas regi√µes, voc√™ deve habilitar a regi√£o primeiro. Saber mais


10. Revise a pol√≠tica do bucket e selecione _I have confirmed that this policy_ (Confirmei que esta pol√≠tica est√° correta) e escolha Salvar.

    Politica padr√£o aplicada

    ~~~json
    {
  "Version": "2008-10-17",
  "Id": "Policy1335892530063",
  "Statement": [
    {
      "Sid": "Stmt1335892150622",
      "Effect": "Allow",
      "Principal": {
        "Service": "billingreports.amazonaws.com"
      },
      "Action": [
        "s3:GetBucketAcl",
        "s3:GetBucketPolicy"
      ],
      "Resource": "arn:aws:s3:::kubecost-aws-cost-and-usage-report",
      "Condition": {
        "StringEquals": {
          "aws:SourceArn": "arn:aws:cur:us-east-1:701893420597:definition/*",
          "aws:SourceAccount": "701893420597"
        }
      }
    },
    {
      "Sid": "Stmt1335892526596",
      "Effect": "Allow",
      "Principal": {
        "Service": "billingreports.amazonaws.com"
      },
      "Action": [
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::kubecost-aws-cost-and-usage-report/*",
      "Condition": {
        "StringEquals": {
          "aws:SourceArn": "arn:aws:cur:us-east-1:701893420597:definition/*",
          "aws:SourceAccount": "701893420597"
        }
      }
    }
  ]
}
    ~~~

11. Para _Report path prefix_ (Prefixo do caminho do relat√≥rio), insira o prefixo do caminho do relat√≥rio que deseja anexar ao nome do seu relat√≥rio.

üìó https://docs.aws.amazon.com/enterprisebilling/6b7c01c5-b592-467e-9769-90052eaf359c/userguide/configuring-eb.html


12. Para granularidade de tempo, escolha uma das seguintes op√ß√µes Time granularity : Daily

    üìå A granularidade de tempo na qual os dados do relat√≥rio s√£o medidos e exibidos.

    üìå Daily:  se desejar que os itens de linha no relat√≥rio sejam agregados por dia.

13. Para Report versioning (Vers√£o de relat√≥rio), escolha se deseja que cada vers√£o do relat√≥rio sobrescreva a vers√£o anterior do relat√≥rio ou seja entregue al√©m das vers√µes anteriores. 

A substitui√ß√£o de relat√≥rios pode economizar nos custos de armazenamento do Amazon S3. A entrega de novas vers√µes de relat√≥rios pode melhorar a capacidade de auditoria dos dados de faturamento ao longo do tempo.

>> Report versioning = Create new report version X 
>> Utilizando o Athena √© selecionado por padr√£o Overwrite existing report, sme a possibilidade de allterar a op√ß√£o


14. Em Enable report data integration for (Habilitar integra√ß√£o de dados de relat√≥rio para), selecione se deseja habilitar seus relat√≥rios de custo e uso para integra√ß√£o com Amazon Athena, Amazon Redshift ou Amazon QuickSight. O relat√≥rio √© compactado nos seguintes formatos:
 * Athena: formato parquet
 * Amazon Redshift ou Amazon QuickSight: compacta√ß√£o .gz


>> Enable report data integration for = Amazon Athena


15. Avan√ßar.


16. Depois de revisar as configura√ß√µes do seu relat√≥rio, escolha Revisar e concluir.



Voc√™ sempre pode retornar √† se√ß√£o Relat√≥rios de custo e uso do console do Billing and Cost Management para ver quando seus relat√≥rios foram atualizados pela √∫ltima vez.